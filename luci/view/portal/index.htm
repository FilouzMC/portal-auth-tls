<%+header%>
<div class="cbi-map">
<h2>Portail Captif</h2>
<p>Ex√©cutez les scripts directement.</p>
<div class="cbi-section">
<button class="btn cbi-button" onclick="portal_run('auth')">Auth</button>
<button class="btn cbi-button" onclick="portal_run('logout')">Logout</button>
<button class="btn cbi-button" onclick="portal_run('update')">Update</button>
</div>
<div id="portal_output_area" style="margin-top:15px;display:none;">
<textarea id="portal_output_text" style="width:100%;height:250px;font-family:monospace;font-size:12px" readonly></textarea>
</div>
</div>
<script type="text/javascript">
function portal_run(script_name) {
  var ta = document.getElementById('portal_output_text');
  var area = document.getElementById('portal_output_area');
  if (!ta || !area) return;
  
  ta.value = 'Execution de ' + script_name + ' en cours...';
  area.style.display = 'block';
  
  var xhr = new XMLHttpRequest();
  xhr.open('POST', '<%=url("admin/system/portal/run")%>', true);
  xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
  
  xhr.onload = function() {
    if (xhr.status === 200) {
      try {
        var response = JSON.parse(xhr.responseText);
        ta.value = 'Status: ' + (response.success ? 'OK' : 'FAIL') + '\n';
        ta.value += response.output;
      } catch (e) {
        ta.value = 'Erreur parse JSON: ' + e.toString();
      }
    } else {
      ta.value = 'HTTP Error ' + xhr.status;
    }
  };
  
  xhr.onerror = function() {
    ta.value = 'Erreur reseau';
  };
  
  xhr.send('script=' + encodeURIComponent(script_name));
}
</script>
<%+footer%>
